<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName packages-ha.entratadev.com
  ServerAlias packages-ha.{{ salt['grains.get']('devuser') }}.entrata.lcl
{% else %}
  ServerName packages-ha.entrata.com
  ServerAlias packages-ha.entrata.com
{%- endif %}

  ServerAdmin webmaster@entrata.com

  RewriteEngine On
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI}

  DocumentRoot /srv/www/vhosts/EntrataHA/www/PackagesHa/

  <Directory "/srv/www/vhosts/EntrataHA/www/PackagesHa/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride FileInfo
    Require all granted
    DirectoryIndex index.php
  </Directory>

  <IfModule php5_module>
    php_value newrelic.appname "HaPackages"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "HaPackages"
  </IfModule>

</VirtualHost>
