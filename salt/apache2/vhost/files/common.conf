<VirtualHost *:80>

{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName common.entratadev.com
  ServerAlias common.{{ salt['grains.get']('devuser') }}.entrata.lcl
  ServerAlias rcommon.entratadev.com
  ServerAlias rcommon.{{ salt['grains.get']('devuser') }}.entrata.lcl
{% elif salt['grains.get']('track') == 'rapid' -%}
  ServerName rcommon.entrata.com
  ServerAlias rcommon.propertysolutions.com
{% elif salt['grains.get']('track') == 'transition' -%}
  ServerName tcommon.entrata.com
  ServerAlias tcommon.propertysolutions.com
{% else -%}
  ServerName common.entrata.com
  ServerAlias common.propertysolutions.com
{% endif -%}

  ServerAdmin webmaster@entrata.com

  DocumentRoot /srv/www/vhosts/Common

  <Directory "/srv/www/vhosts/Common">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride None
    Options None
    Require all granted
  </Directory>

  <IfModule php5_module>
    php_value newrelic.appname "Common {{ salt['grains.get']('track') }};Common"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "Common {{ salt['grains.get']('track') }};Common"
  </IfModule>
{% if salt.grains.get('track') == 'standard' %}
  <Files ~ "\.js$">
    Header set "Cache-Control" "max-age=86400, public, must-revalidate"
    FileETag None
  </Files>
{% elif salt.grains.get('track') == 'rapid' %}
  <Files ~ "\.js$">
    Header set "Cache-Control" "max-age=86400, public, must-revalidate"
    FileETag None
  </Files>
{% endif %}
  <Files ~ "\.(gif|jpe?g|png|css|ico|xml|swf|woff|ttf)$">
    Header set "Cache-Control" "max-age=86400, public, must-revalidate"
    FileETag None
  </Files>

# Below commented to allow above cache changes - based on ticket #41910
#  Include /etc/apache2/conf-available/cache.conf

</VirtualHost>
