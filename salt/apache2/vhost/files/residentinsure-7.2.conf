<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName api.residentinsuredev.com
  ServerAlias api.{{ salt['grains.get']('devuser') }}.residentinsure.lcl
{% else %}
  ServerName api.residentinsure.com
{%- endif %}

  ServerAdmin webmaster@entrata.com

  DocumentRoot /srv/www/vhosts/ResidentInsure/www/api/

  <Directory "/srv/www/vhosts/ResidentInsure/www/api/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride All
    Options +FollowSymLinks -MultiViews
    Require all granted
    CGIPassAuth On
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
  </Directory>

  <IfModule php5_module>
    php_value newrelic.appname "Residentinsure {{ salt['grains.get']('track') }};Residentinsure"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "Residentinsure {{ salt['grains.get']('track') }};Residentinsure"
  </IfModule>

  Include /etc/apache2/conf-available/common.conf

</VirtualHost>

<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName residentinsuredev.com
  ServerAlias {{ salt['grains.get']('devuser') }}.residentinsure.lcl
  ServerAlias *.residentinsuredev.com
  ServerAlias *.{{ salt['grains.get']('devuser') }}.residentinsure.lcl
{% else %}
  ServerName www.residentinsure.com
  ServerAlias residentinsure.com
  ServerAlias *.residentinsure.com
{%- endif %}

  ServerAdmin webmaster@entrata.com

  DocumentRoot /srv/www/vhosts/ResidentInsure/www/website/

  <Directory "/srv/www/vhosts/ResidentInsure/www/website/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    Options Indexes Includes FollowSymLinks MultiViews
    AllowOverride FileInfo
    Require all granted
  </Directory>

  RewriteEngine On
  RewriteCond %{HTTP_HOST} ^residentinsure.com [nocase]
  RewriteRule ^/(.*)$ http://www.residentinsure.com/$1 [redirect=301]

  <IfModule php5_module>
    php_value newrelic.appname "Residentinsure {{ salt['grains.get']('track') }};Residentinsure"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "Residentinsure {{ salt['grains.get']('track') }};Residentinsure"
  </IfModule>

  Include /etc/apache2/conf-available/common.conf

</VirtualHost>
