<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName www.entratadev.com
  ServerAlias www.{{ salt['grains.get']('devuser') }}.entrata.lcl
  ServerAlias entratadev.com
  ServerAlias {{ salt['grains.get']('devuser') }}.entrata.lcl
{% else %}
  ServerName www.entrata.com
  ServerAlias entrata.com
{%- endif %}

  ServerAdmin webmaster@propertysolutions.com

  DocumentRoot /srv/www/vhosts/EntrataWebsite/www/EntrataWebsite/

  Alias /entrata_website/ /srv/www/vhosts/NonBackupMounts/Global/ps_website/

  <Directory "/srv/www/vhosts/EntrataWebsite/www/EntrataWebsite/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride FileInfo Options
    Options None
    Require all granted
  </Directory>

  <Directory "/srv/www/vhosts/NonBackupMounts/Global/ps_website">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride None
    Options None
    Require all granted
  </Directory>

  RewriteEngine On
  RewriteCond %{HTTP_HOST} ^entrata.com [nocase]
  RewriteRule ^/(.*)$ https://www.entrata.com/$1 [redirect=301]

  <IfModule php5_module>
    php_value newrelic.appname "WWWEntrata {{ salt['grains.get']('track') }};WWWEntrata"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "WWWEntrata {{ salt['grains.get']('track') }};WWWEntrata"
  </IfModule>

  Include /etc/apache2/conf-available/newrelic.conf
  Include /etc/apache2/conf-available/common.conf

</VirtualHost>
