<VirtualHost *:80>

{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName residentsync.entratadev.com
  ServerAlias residentsync.{{ salt['grains.get']('devuser') }}.entrata.lcl
  ServerAlias rresidentsync.entratadev.com
  ServerAlias rresidentsync.{{ salt['grains.get']('devuser') }}.entrata.lcl
{% elif salt['grains.get']('track') == 'rapid' -%}
  ServerName rresidentsync.entrata.com
  ServerAlias rresidentsync.propertysolutions.com
{% elif salt['grains.get']('track') == 'transition' %}
  ServerName tresidentsync.entrata.com
  ServerAlias tresidentsync.propertysolutions.com
{% else -%}
  ServerName residentsync.entrata.com
  ServerAlias residentsync.propertysolutions.com
{% endif -%}
  ServerAdmin webmaster@entrata.com

  DocumentRoot /srv/www/vhosts/Entrata/www/ResidentSync

  <Directory "/srv/www/vhosts/Entrata/www/ResidentSync/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride Fileinfo
    Options FollowSymLinks SymLinksIfOwnerMatch
    Require all granted
  </Directory>

  <IfModule php5_module>
    php_value newrelic.appname "ResidentSync {{ salt['grains.get']('track') }};ResidentSync"
  </IfModule>

  <IfModule php7_module>
    php_value newrelic.appname "ResidentSync {{ salt['grains.get']('track') }};ResidentSync"
  </IfModule>

  Include /etc/apache2/conf-available/common.conf

</VirtualHost>
