<VirtualHost *:80>

  ServerName nagios.propertysolutions.com

  RewriteEngine On
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]

</VirtualHost>

<VirtualHost *:443>

  ServerName nagios.propertysolutions.com

  ScriptAlias /cgi-bin/nagios3 /usr/lib/cgi-bin/nagios3
  ScriptAlias /nagios3/cgi-bin /usr/lib/cgi-bin/nagios3

  Alias /stylesheets /etc/nagios3/stylesheets
  #Alias /nagios3 /usr/share/nagios3/htdocs
  DocumentRoot /usr/share/nagios3/htdocs

  <DirectoryMatch (/usr/share/nagios3/htdocs|/usr/lib/cgi-bin/nagios3|/etc/nagios3/stylesheets)>
    Options FollowSymLinks

    DirectoryIndex index.php index.html

    AllowOverride AuthConfig

{% if salt['network.in_subnet']('10.7.0.0/16') %}
    AuthName "Nagios Access"
    AuthType Basic
    AuthUserFile /etc/nagios3/htpasswd.users
{%- else %}
    AuthBasicProvider ldap
    AuthType Basic
    AuthName "Please Use Your Windows UserName And Password"
    AuthLDAPURL "ldap://ln-ad01.entrata.com:3268/DC=dc2,DC=propsol,DC=org?sAMAccountName?sub?(objectClass=user)"
    AuthLDAPBindDN "subversion@dc2.propsol.org"
    AuthLDAPBindPassword #r10mpmfcrpp$
{%- endif %}
    Require valid-user
</DirectoryMatch>

<Directory /usr/share/nagios3/htdocs>
    Options +ExecCGI
</Directory>

  SSLEngine On
  SSLCertificateFile /etc/apache2/ssl/star.propertysolutions.com.crt
  SSLCertificateChainFile /etc/apache2/ssl/gd_bundle_g2_g1.crt
  SSLCertificateKeyFile /etc/apache2/ssl/star.propertysolutions.com.key

</VirtualHost>
# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
