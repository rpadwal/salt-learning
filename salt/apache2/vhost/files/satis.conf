{%- set server = 'composer-tst' if salt['grains.get']('environment') == 'tst' else 'composer' -%}
<VirtualHost *:80>
  ServerName {{ server }}.entrata.com

  ServerAdmin webmaster@entrata.com

  DocumentRoot /var/www/html/repository

  <Directory /var/www/html/repository>
    Options -Indexes
  </Directory>

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^/?(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

<VirtualHost *:443>
  ServerName composer.entrata.com

  ServerAdmin webmaster@entrata.com

  DocumentRoot /var/www/html/repository

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  SSLEngine On
  SSLCertificateFile /etc/apache2/ssl/star.entrata.com.crt
  SSLCertificateChainFile /etc/apache2/ssl/networksolutions_bundle.crt
  SSLCertificateKeyFile /etc/apache2/ssl/star.entrata.com.key

</VirtualHost>
