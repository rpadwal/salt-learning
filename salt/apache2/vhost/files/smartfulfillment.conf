<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' %}
  ServerName smartfulfillment.entratadev.com
  ServerAlias smartfulfillment.{{ salt['grains.get']('devuser') }}.entrata.lcl
{% else %}
  ServerName smartfulfillment.entrata.com
{% endif %}
  ServerAdmin webmaster@entrata.com

  RewriteEngine On
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI}

  DocumentRoot /srv/www/vhosts/EntrataHA/www/SmartFulfillment/

  <Directory "/srv/www/vhosts/EntrataHA/www/SmartFulfillment/">
    <LimitExcept GET POST HEAD>
      Require all denied
    </LimitExcept>
    AllowOverride All
    Options +ExecCGI -Includes
    Require all granted
  </Directory>

  Include /etc/apache2/conf-available/common.conf
  Include /etc/apache2/conf-available/medialibrary.conf
  Include /etc/apache2/conf-available/newrelic.conf
</VirtualHost>
