<VirtualHost *:80>
{% if salt['grains.get']('environment') == 'lcl' -%}
  ServerName chat.entratadev.com
  ServerAlias chat.{{ salt['grains.get']('devuser') }}.entrata.lcl
{% else %}
  ServerName chat.entrata.com
{%- endif %}

  ServerAdmin webmaster@entrata.com

  DocumentRoot /srv/www/vhosts/Entrata/www/Chat/

  <Directory "/srv/www/vhosts/Entrata/www/Chat/">
    <LimitExcept GET POST HEAD OPTIONS>
      Require all denied
    </LimitExcept>
    AllowOverride None
    Options None
    Require all granted
  </Directory>
{% if salt['grains.get']('environment') != 'lcl' %}
  ProxyPass /e-httpbind http://192.168.160.141:5280/http-bind/ ttl=30
  ProxyPassReverse /e-httpbind http://192.168.160.141:5280/http-bind/
  ProxyStatus On
{%- endif %}

  Include /etc/apache2/conf-available/common.conf
  Include /etc/apache2/conf-available/newrelic.conf

</VirtualHost>
