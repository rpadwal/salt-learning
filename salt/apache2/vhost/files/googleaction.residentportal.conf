<VirtualHost *:80>
{% if salt['grains.get']('track') == 'rapid' %}
  ServerName rgoogleaction.residentportal.com
{% elif salt['grains.get']('environment') == 'lcl' %}
  ServerName rgoogleaction.residentportaldev.com
  ServerAlias rgoogleaction.{{ salt['grains.get']('devuser') }}.residentportal.lcl
{% else %}
  ServerName googleaction.residentportal.com
{% endif %}
  DocumentRoot /srv/www/vhosts/Entrata/www/ResidentPortal/google/
  ServerAdmin webmaster@entrata.com

  <Files ~ (Apartments|index)>
    ForceType application/x-httpd-php
  </Files>

  <Directory "/srv/www/vhosts/Entrata/www/ResidentPortal/google/">
    <LimitExcept GET POST>
      Require all denied
    </LimitExcept>

    AllowOverride None
    Options +FollowSymLinks -MultiViews
    Require all granted
    CGIPassAuth On
    SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
  </Directory>

  RewriteEngine On
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^/([a-zA-Z]*)$ /index.php?action=$1 [QSA,L]

  Include /etc/apache2/conf-available/common.conf
  Include /etc/apache2/conf-available/newrelic.conf

</VirtualHost>
