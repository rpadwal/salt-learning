{% set entrata_directives = {
  'max_execution_time': '120' if ('track' in grains and grains.track == 'rapid') else '360',
  'memory_limit': '4096M',
  'post_max_size': '50M',
  'upload_max_filesize': '50M',
  'session.gc_maxlifetime': '18000',
  'max_input_vars': '150000',
  'newrelic.browser_monitoring.attributes.enabled': 'true',
  }
%}

{% set residentportal_directives = {
  'max_input_vars': '15000',
  'newrelic.browser_monitoring.attributes.enabled': 'true',
  'post_max_size': '100M',
  'upload_max_filesize': '100M',
  'max_file_uploads': '40',
  }
%}

{% set prospectportal_directives = {
  'max_input_vars': '15000',
  'newrelic.browser_monitoring.attributes.enabled': 'true',
  }
%}

{% set directives = salt['grains.filter_by']({
  'base': {
    'date.timezone': 'America/Denver',
    'disable_functions': '',
    'upload_max_filesize': '50M',
    'memory_limit': '2048M',
    'max_input_vars': '15000',
    'sendmail_path': '"/usr/lib/sendmail -t -i -F system@entrata.com -f system@entrata.com"',
    'session.gc_maxlifetime': '3600',
    'session.gc_probability': '1',
    'session.hash_function': '1',
    'session.save_path': '"/tmp"',
    'short_open_tag': 'On',
    'error_reporting': 'E_ALL & ~E_NOTICE & ~E_DEPRECATED & ~E_STRICT',
    'error_log': 'syslog',
    'post_max_size': '50M',
    'ignore_repeated_errors': '1',
    'expose_php': '0',
    'max_execution_time': '30',
    'mysqli.default_socket': '/var/run/mysqld/mysqld.sock',
    'pdo_mysql.default_socket': '/var/run/mysqld/mysqld.sock',
    'realpath_cache_size': '256k',
  },
  'clientadmin': entrata_directives,
  'entrata': entrata_directives,
  'prospectportal': prospectportal_directives,
  'residentportal': residentportal_directives,
}, grain='vhost', base='base' ) %}

{% if grains.role == 'script' %}
  {%- set _ = directives.update({
    'memory_limit': '4096M',
    'max_execution_time': '300',
    'max_input_vars': '150000',
    'error_reporting': 'E_ALL & ~E_DEPRECATED & ~E_STRICT',
    'session.gc_maxlifetime': '18000',
  }) %}
{% else %}
  {%- set _ = directives.update({
    'opcache.max_accelerated_files': '16000',
    'opcache.revalidate_freq': '30',
    'opcache.memory_consumption': '1024',
    'opcache.optimization_level': '0xFFFFFFFF',
  }) %}
{% endif %}
